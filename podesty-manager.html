<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PawStock ‚Äî ZarzƒÖdzanie ProdukcjƒÖ Podest√≥w</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=Outfit:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #faf7f2;
  --surface: #ffffff;
  --card: #f5f0e8;
  --border: #e8e0d0;
  --border2: #d4c9b5;
  --accent: #2d5016;
  --accent-light: #4a7c28;
  --accent-bg: #edf4e6;
  --amber: #c47c1a;
  --amber-bg: #fef3e0;
  --red: #c0392b;
  --red-bg: #fdecea;
  --text: #1a1510;
  --text2: #5a5040;
  --muted: #9a8f7f;
  --shadow: 0 2px 12px rgba(45,80,22,0.08);
  --shadow-lg: 0 8px 32px rgba(45,80,22,0.12);
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Outfit', sans-serif;
  min-height: 100vh;
}

/* GRAIN OVERLAY */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
  pointer-events: none;
  z-index: 0;
  opacity: 0.6;
}

/* HEADER */
header {
  background: var(--accent);
  color: white;
  padding: 0 40px;
  height: 64px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  z-index: 200;
  box-shadow: 0 4px 20px rgba(45,80,22,0.3);
}

.logo {
  font-family: 'Syne', sans-serif;
  font-weight: 800;
  font-size: 1.4rem;
  letter-spacing: -0.5px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.logo-paw { font-size: 1.6rem; }

.logo-sub {
  font-family: 'Outfit', sans-serif;
  font-weight: 300;
  font-size: 0.75rem;
  opacity: 0.7;
  letter-spacing: 2px;
  text-transform: uppercase;
  display: block;
  line-height: 1;
  margin-top: 1px;
}

.nav-tabs {
  display: flex;
  gap: 4px;
}

.nav-tab {
  padding: 8px 20px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 0.85rem;
  font-weight: 500;
  color: rgba(255,255,255,0.65);
  transition: all 0.2s;
  border: none;
  background: transparent;
  font-family: 'Outfit', sans-serif;
  display: flex;
  align-items: center;
  gap: 7px;
}

.nav-tab:hover { color: white; background: rgba(255,255,255,0.1); }
.nav-tab.active { color: white; background: rgba(255,255,255,0.18); }

.nav-badge {
  background: var(--amber);
  color: white;
  border-radius: 10px;
  padding: 1px 7px;
  font-size: 0.7rem;
  font-family: 'JetBrains Mono', monospace;
  font-weight: 500;
  min-width: 20px;
  text-align: center;
}

/* LAYOUT */
.app {
  position: relative;
  z-index: 1;
  max-width: 1400px;
  margin: 0 auto;
  padding: 32px 40px;
}

/* VIEWS */
.view { display: none; }
.view.active { display: block; }

/* PAGE HEADER */
.page-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 28px;
  flex-wrap: wrap;
  gap: 16px;
}

.page-title {
  font-family: 'Syne', sans-serif;
  font-size: 1.8rem;
  font-weight: 800;
  color: var(--accent);
  letter-spacing: -0.5px;
}

.page-subtitle {
  font-size: 0.85rem;
  color: var(--muted);
  margin-top: 2px;
}

/* BUTTONS */
.btn {
  padding: 10px 20px;
  border-radius: 8px;
  font-family: 'Outfit', sans-serif;
  font-size: 0.88rem;
  font-weight: 500;
  cursor: pointer;
  border: none;
  transition: all 0.2s;
  display: inline-flex;
  align-items: center;
  gap: 7px;
}

.btn-primary {
  background: var(--accent);
  color: white;
}
.btn-primary:hover { background: var(--accent-light); transform: translateY(-1px); box-shadow: var(--shadow-lg); }

.btn-secondary {
  background: var(--surface);
  color: var(--text2);
  border: 1px solid var(--border2);
}
.btn-secondary:hover { border-color: var(--accent); color: var(--accent); }

.btn-danger {
  background: var(--red-bg);
  color: var(--red);
  border: 1px solid transparent;
}
.btn-danger:hover { border-color: var(--red); }

.btn-sm { padding: 6px 12px; font-size: 0.78rem; }
.btn-icon { padding: 8px; width: 34px; height: 34px; justify-content: center; }

/* CARDS */
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 14px;
  box-shadow: var(--shadow);
}

/* STATS ROW */
.stats-row {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 16px;
  margin-bottom: 28px;
}

.stat-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 20px 22px;
  box-shadow: var(--shadow);
}

.stat-label {
  font-size: 0.75rem;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 1px;
  font-weight: 500;
  margin-bottom: 8px;
}

.stat-value {
  font-family: 'Syne', sans-serif;
  font-size: 2.2rem;
  font-weight: 800;
  color: var(--accent);
  line-height: 1;
}

.stat-sub {
  font-size: 0.75rem;
  color: var(--muted);
  margin-top: 4px;
}

.stat-card.warn .stat-value { color: var(--amber); }
.stat-card.danger .stat-value { color: var(--red); }

/* TABLE */
.table-wrap {
  overflow-x: auto;
  border-radius: 14px;
  box-shadow: var(--shadow);
}

table {
  width: 100%;
  border-collapse: collapse;
  background: var(--surface);
}

thead tr {
  background: var(--card);
  border-bottom: 2px solid var(--border);
}

th {
  padding: 12px 18px;
  text-align: left;
  font-size: 0.72rem;
  font-weight: 600;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 1px;
  white-space: nowrap;
}

td {
  padding: 13px 18px;
  border-bottom: 1px solid var(--border);
  font-size: 0.9rem;
  vertical-align: middle;
}

tr:last-child td { border-bottom: none; }

tr:hover td { background: var(--card); }

.sku-badge {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.78rem;
  background: var(--accent-bg);
  color: var(--accent);
  padding: 3px 10px;
  border-radius: 5px;
  font-weight: 500;
  border: 1px solid rgba(45,80,22,0.15);
}

.stock-badge {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 0.78rem;
  font-weight: 600;
  font-family: 'JetBrains Mono', monospace;
}

.stock-ok { background: var(--accent-bg); color: var(--accent); }
.stock-low { background: var(--amber-bg); color: var(--amber); }
.stock-out { background: var(--red-bg); color: var(--red); }

/* MODAL */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(26,21,16,0.5);
  backdrop-filter: blur(4px);
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  animation: fadeIn 0.15s ease;
}

@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
@keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

.modal {
  background: var(--surface);
  border-radius: 16px;
  box-shadow: 0 24px 64px rgba(0,0,0,0.25);
  width: 100%;
  max-width: 480px;
  animation: slideUp 0.2s ease;
  border: 1px solid var(--border);
}

.modal-header {
  padding: 24px 28px 0;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.modal-title {
  font-family: 'Syne', sans-serif;
  font-size: 1.2rem;
  font-weight: 700;
  color: var(--accent);
}

.modal-close {
  width: 32px;
  height: 32px;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: transparent;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--muted);
  font-size: 1.1rem;
  transition: all 0.15s;
}

.modal-close:hover { background: var(--red-bg); color: var(--red); border-color: var(--red); }

.modal-body { padding: 20px 28px; }
.modal-footer { padding: 0 28px 24px; display: flex; gap: 10px; justify-content: flex-end; }

/* FORM */
.form-group {
  margin-bottom: 16px;
}

.form-group label {
  display: block;
  font-size: 0.78rem;
  font-weight: 600;
  color: var(--text2);
  text-transform: uppercase;
  letter-spacing: 0.8px;
  margin-bottom: 6px;
}

.form-group input,
.form-group select,
.form-group textarea {
  width: 100%;
  padding: 11px 14px;
  border: 1.5px solid var(--border);
  border-radius: 8px;
  font-family: 'Outfit', sans-serif;
  font-size: 0.92rem;
  color: var(--text);
  background: var(--bg);
  outline: none;
  transition: border-color 0.2s, box-shadow 0.2s;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(45,80,22,0.1);
}

.form-group input.error { border-color: var(--red); }
.form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

/* ORDER INPUT SECTION */
.order-panel {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
  margin-bottom: 32px;
}

.panel-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 24px;
  box-shadow: var(--shadow);
}

.panel-card-title {
  font-family: 'Syne', sans-serif;
  font-size: 1rem;
  font-weight: 700;
  color: var(--accent);
  margin-bottom: 18px;
  display: flex;
  align-items: center;
  gap: 8px;
}

/* QUEUE */
.queue-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.queue-item {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 18px 20px;
  box-shadow: var(--shadow);
  display: grid;
  grid-template-columns: 40px 1fr auto;
  gap: 16px;
  align-items: center;
  transition: all 0.2s;
  animation: slideUp 0.3s ease;
}

.queue-item:hover { border-color: var(--accent); box-shadow: var(--shadow-lg); }

.queue-item.done {
  opacity: 0.5;
  border-style: dashed;
}

.queue-pos {
  width: 40px;
  height: 40px;
  background: var(--accent);
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: 'Syne', sans-serif;
  font-size: 1.1rem;
  font-weight: 800;
  color: white;
  flex-shrink: 0;
}

.queue-pos.high { background: var(--red); }
.queue-pos.low { background: var(--muted); }

.queue-info {}
.queue-name { font-weight: 600; font-size: 0.95rem; margin-bottom: 4px; }
.queue-meta {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  align-items: center;
}

.queue-chip {
  font-size: 0.72rem;
  font-family: 'JetBrains Mono', monospace;
  color: var(--muted);
  background: var(--card);
  padding: 2px 8px;
  border-radius: 4px;
  border: 1px solid var(--border);
}

.queue-chip.deadline {
  color: var(--amber);
  background: var(--amber-bg);
  border-color: rgba(196,124,26,0.2);
}

.queue-chip.deadline.urgent {
  color: var(--red);
  background: var(--red-bg);
  border-color: rgba(192,57,43,0.2);
}

.queue-chip.qty {
  color: var(--accent);
  background: var(--accent-bg);
  border-color: rgba(45,80,22,0.15);
}

.queue-actions {
  display: flex;
  gap: 6px;
  flex-shrink: 0;
}

/* PRIORITY SELECT */
.prio-select {
  display: flex;
  gap: 6px;
}

.prio-opt {
  flex: 1;
  padding: 8px 4px;
  border-radius: 6px;
  border: 1.5px solid var(--border);
  text-align: center;
  font-size: 0.78rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.15s;
  color: var(--muted);
  background: var(--bg);
}

.prio-opt:hover { border-color: var(--text2); color: var(--text2); }
.prio-opt.selected[data-p="1"] { background: var(--red-bg); border-color: var(--red); color: var(--red); }
.prio-opt.selected[data-p="2"] { background: var(--amber-bg); border-color: var(--amber); color: var(--amber); }
.prio-opt.selected[data-p="3"] { background: var(--accent-bg); border-color: var(--accent); color: var(--accent); }

/* STOCK QTY INPUT */
.qty-control {
  display: flex;
  align-items: center;
  gap: 0;
  border: 1.5px solid var(--border);
  border-radius: 8px;
  overflow: hidden;
  background: var(--bg);
  width: 130px;
}

.qty-control button {
  width: 36px;
  height: 38px;
  border: none;
  background: transparent;
  cursor: pointer;
  font-size: 1.1rem;
  color: var(--text2);
  transition: background 0.15s;
  flex-shrink: 0;
}

.qty-control button:hover { background: var(--card); }

.qty-control input {
  flex: 1;
  text-align: center;
  border: none;
  background: transparent;
  padding: 0;
  font-size: 0.9rem;
  font-family: 'JetBrains Mono', monospace;
  font-weight: 500;
  color: var(--text);
  outline: none;
  width: 50px;
  box-shadow: none !important;
}

/* NOTIFICATION */
.notification {
  position: fixed;
  bottom: 24px;
  right: 24px;
  background: var(--accent);
  color: white;
  padding: 14px 20px;
  border-radius: 10px;
  font-size: 0.88rem;
  font-weight: 500;
  box-shadow: var(--shadow-lg);
  z-index: 2000;
  animation: slideUp 0.3s ease;
  max-width: 320px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.notification.warn { background: var(--amber); }
.notification.error { background: var(--red); }

/* ORDER RESULT */
.order-result {
  background: var(--card);
  border: 1.5px solid var(--border2);
  border-radius: 10px;
  padding: 16px 18px;
  margin-top: 14px;
  font-size: 0.88rem;
}

.order-result.success { background: var(--accent-bg); border-color: rgba(45,80,22,0.25); }
.order-result.added { background: var(--amber-bg); border-color: rgba(196,124,26,0.25); }

.order-result-title {
  font-weight: 600;
  font-size: 0.92rem;
  margin-bottom: 6px;
  display: flex;
  align-items: center;
  gap: 7px;
}

.order-result.success .order-result-title { color: var(--accent); }
.order-result.added .order-result-title { color: var(--amber); }

.order-result p { color: var(--text2); line-height: 1.5; }

/* EMPTY */
.empty {
  text-align: center;
  padding: 60px 20px;
  color: var(--muted);
}

.empty-icon { font-size: 3rem; margin-bottom: 12px; opacity: 0.4; }
.empty-title { font-family: 'Syne', sans-serif; font-size: 1.1rem; font-weight: 700; margin-bottom: 6px; color: var(--text2); }
.empty-sub { font-size: 0.85rem; }

/* SEARCH */
.search-bar {
  display: flex;
  gap: 12px;
  margin-bottom: 20px;
}

.search-bar input {
  flex: 1;
  padding: 10px 16px;
  border: 1.5px solid var(--border);
  border-radius: 8px;
  font-family: 'Outfit', sans-serif;
  font-size: 0.9rem;
  background: var(--surface);
  outline: none;
  transition: border-color 0.2s;
  color: var(--text);
}

.search-bar input:focus { border-color: var(--accent); }

/* SCROLLBAR */
::-webkit-scrollbar { width: 6px; height: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 3px; }

/* SKU AUTOCOMPLETE */
.sku-input-wrap { position: relative; }
.sku-dropdown {
  position: absolute;
  top: calc(100% + 4px);
  left: 0; right: 0;
  background: var(--surface);
  border: 1.5px solid var(--accent);
  border-radius: 8px;
  box-shadow: var(--shadow-lg);
  z-index: 100;
  max-height: 220px;
  overflow-y: auto;
}

.sku-option {
  padding: 10px 14px;
  cursor: pointer;
  font-size: 0.88rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: background 0.1s;
  border-bottom: 1px solid var(--border);
}

.sku-option:last-child { border-bottom: none; }
.sku-option:hover { background: var(--card); }
.sku-option .so-sku { font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: var(--accent); }
.sku-option .so-name { color: var(--text); font-weight: 500; }
.sku-option .so-stock { font-family: 'JetBrains Mono', monospace; font-size: 0.72rem; }

/* SECTION */
.section-title {
  font-family: 'Syne', sans-serif;
  font-size: 0.8rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1.5px;
  color: var(--muted);
  margin-bottom: 14px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.section-title::after {
  content: '';
  flex: 1;
  height: 1px;
  background: var(--border);
}

@media (max-width: 900px) {
  .app { padding: 20px; }
  .order-panel { grid-template-columns: 1fr; }
  .stats-row { grid-template-columns: repeat(2, 1fr); }
  header { padding: 0 20px; }
  .nav-tab span { display: none; }
}
</style>
</head>
<body>

<header>
  <div class="logo">
    <span class="logo-paw">üêæ</span>
    <div>
      PawStock
      <span class="logo-sub">System zarzƒÖdzania produkcjƒÖ podest√≥w</span>
    </div>
  </div>
  <nav class="nav-tabs">
    <button class="nav-tab active" onclick="switchView('orders')" id="tab-orders">
      üì¶ <span>Zam√≥wienia</span>
    </button>
    <button class="nav-tab" onclick="switchView('queue')" id="tab-queue">
      ‚öô <span>Kolejka</span>
      <span class="nav-badge" id="queue-count">0</span>
    </button>
    <button class="nav-tab" onclick="switchView('catalog')" id="tab-catalog">
      üìã <span>Katalog</span>
    </button>
    <button class="nav-tab" onclick="switchView('stock')" id="tab-stock">
      üè≠ <span>Magazyn</span>
    </button>
  </nav>
</header>

<div class="app">

  <!-- ===================== ZAM√ìWIENIA ===================== -->
  <div class="view active" id="view-orders">
    <div class="page-header">
      <div>
        <div class="page-title">Nowe zam√≥wienie</div>
        <div class="page-subtitle">Wprowad≈∫ SKU produktu aby sprawdziƒá stan magazynu</div>
      </div>
    </div>

    <div class="stats-row" id="stats-row">
      <div class="stat-card">
        <div class="stat-label">Produkty w katalogu</div>
        <div class="stat-value" id="stat-products">0</div>
        <div class="stat-sub">aktywnych SKU</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Na stanie magazynu</div>
        <div class="stat-value" id="stat-instock">0</div>
        <div class="stat-sub">gotowe do wysy≈Çki</div>
      </div>
      <div class="stat-card warn">
        <div class="stat-label">W kolejce produkcyjnej</div>
        <div class="stat-value" id="stat-queue">0</div>
        <div class="stat-sub">oczekuje na produkcjƒô</div>
      </div>
      <div class="stat-card danger">
        <div class="stat-label">Zerowy stan</div>
        <div class="stat-value" id="stat-outofstock">0</div>
        <div class="stat-sub">produkt√≥w</div>
      </div>
    </div>

    <div class="order-panel">
      <div class="panel-card">
        <div class="panel-card-title">üì¶ Sprawd≈∫ zam√≥wienie</div>

        <div class="form-group">
          <label>SKU produktu</label>
          <div class="sku-input-wrap">
            <input type="text" id="order-sku" placeholder="np. POD-M-OAK-01" autocomplete="off"
              oninput="skuAutocomplete(this.value)" onkeydown="skuKeydown(event)" onblur="setTimeout(closeSkuDropdown,150)">
            <div class="sku-dropdown" id="sku-dropdown" style="display:none"></div>
          </div>
        </div>

        <div class="form-group">
          <label>Ilo≈õƒá</label>
          <div class="qty-control">
            <button onclick="changeQty('order-qty', -1)">‚àí</button>
            <input type="number" id="order-qty" value="1" min="1">
            <button onclick="changeQty('order-qty', 1)">+</button>
          </div>
        </div>

        <div class="form-group">
          <label>Termin realizacji (opcjonalnie)</label>
          <input type="date" id="order-deadline">
        </div>

        <div class="form-group">
          <label>Priorytet</label>
          <div class="prio-select" id="prio-select">
            <div class="prio-opt" data-p="1" onclick="selectPrio(1)">üî¥ Wysoki</div>
            <div class="prio-opt selected" data-p="2" onclick="selectPrio(2)">üü° Normalny</div>
            <div class="prio-opt" data-p="3" onclick="selectPrio(3)">üü¢ Niski</div>
          </div>
        </div>

        <button class="btn btn-primary" style="width:100%" onclick="processOrder()">
          ‚úì Sprawd≈∫ i realizuj zam√≥wienie
        </button>

        <div id="order-result"></div>
      </div>

      <div class="panel-card">
        <div class="panel-card-title">üìå Ostatnie zam√≥wienia</div>
        <div id="recent-orders">
          <div class="empty">
            <div class="empty-icon">üìã</div>
            <div class="empty-title">Brak historii</div>
            <div class="empty-sub">Tutaj pojawiƒÖ siƒô ostatnie zam√≥wienia</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===================== KOLEJKA ===================== -->
  <div class="view" id="view-queue">
    <div class="page-header">
      <div>
        <div class="page-title">Kolejka produkcyjna</div>
        <div class="page-subtitle">ZarzƒÖdzaj zleceniami do wyprodukowania</div>
      </div>
      <button class="btn btn-secondary" onclick="clearDoneQueue()">üóë Usu≈Ñ uko≈Ñczone</button>
    </div>

    <div id="queue-container">
      <div class="empty">
        <div class="empty-icon">‚úÖ</div>
        <div class="empty-title">Kolejka pusta</div>
        <div class="empty-sub">Wszystkie zam√≥wienia sƒÖ zrealizowane</div>
      </div>
    </div>
  </div>

  <!-- ===================== KATALOG ===================== -->
  <div class="view" id="view-catalog">
    <div class="page-header">
      <div>
        <div class="page-title">Katalog produkt√≥w</div>
        <div class="page-subtitle">ZarzƒÖdzaj swoimi produktami i SKU</div>
      </div>
      <button class="btn btn-primary" onclick="openAddProduct()">+ Dodaj produkt</button>
    </div>

    <div class="search-bar">
      <input type="text" placeholder="Szukaj po nazwie lub SKU..." oninput="filterCatalog(this.value)" id="catalog-search">
    </div>

    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>SKU</th>
            <th>Nazwa produktu</th>
            <th>Opis</th>
            <th>Cena (PLN)</th>
            <th>Stan magazynu</th>
            <th>Min. stan</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="catalog-body">
        </tbody>
      </table>
    </div>
  </div>

  <!-- ===================== MAGAZYN ===================== -->
  <div class="view" id="view-stock">
    <div class="page-header">
      <div>
        <div class="page-title">ZarzƒÖdzanie magazynem</div>
        <div class="page-subtitle">Aktualizuj stany magazynowe po produkcji</div>
      </div>
    </div>

    <div class="section-title">Produkty z niskim stanem lub brakiem</div>
    <div id="stock-alerts" style="margin-bottom:28px"></div>

    <div class="section-title">Wszystkie stany</div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>SKU</th>
            <th>Nazwa produktu</th>
            <th>Stan magazynu</th>
            <th>Min. stan</th>
            <th>Status</th>
            <th>Aktualizuj stan</th>
          </tr>
        </thead>
        <tbody id="stock-body"></tbody>
      </table>
    </div>
  </div>

</div><!-- /app -->

<!-- ==================== MODALS ==================== -->
<div class="modal-overlay" id="modal-product" style="display:none" onclick="if(event.target===this)closeModal('modal-product')">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title" id="modal-product-title">Dodaj produkt</div>
      <button class="modal-close" onclick="closeModal('modal-product')">‚úï</button>
    </div>
    <div class="modal-body">
      <input type="hidden" id="edit-product-id">
      <div class="form-row">
        <div class="form-group">
          <label>SKU *</label>
          <input type="text" id="p-sku" placeholder="POD-M-OAK-01" style="text-transform:uppercase">
        </div>
        <div class="form-group">
          <label>Cena (PLN)</label>
          <input type="number" id="p-price" placeholder="0.00" min="0" step="0.01">
        </div>
      </div>
      <div class="form-group">
        <label>Nazwa produktu *</label>
        <input type="text" id="p-name" placeholder="Podest dla psa M ‚Äî DƒÖb naturalny">
      </div>
      <div class="form-group">
        <label>Opis (opcjonalnie)</label>
        <input type="text" id="p-desc" placeholder="np. wymiary, materia≈Ç, kolor...">
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Stan magazynu</label>
          <input type="number" id="p-stock" value="0" min="0">
        </div>
        <div class="form-group">
          <label>Minimalny stan</label>
          <input type="number" id="p-min" value="2" min="0">
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal('modal-product')">Anuluj</button>
      <button class="btn btn-primary" onclick="saveProduct()">Zapisz produkt</button>
    </div>
  </div>
</div>

<script>
// ============================================================
// STATE & STORAGE
// ============================================================
let products = [];
let queue = [];
let orderHistory = [];
let selectedPrio = 2;
let editingProductId = null;
let skuDropdownActive = -1;

async function loadData() {
  try {
    const pr = await window.storage.get('pawstock-products');
    if (pr) products = JSON.parse(pr.value);
  } catch(e) { products = []; }

  try {
    const qu = await window.storage.get('pawstock-queue');
    if (qu) queue = JSON.parse(qu.value);
  } catch(e) { queue = []; }

  try {
    const oh = await window.storage.get('pawstock-orders');
    if (oh) orderHistory = JSON.parse(oh.value);
  } catch(e) { orderHistory = []; }

  render();
}

async function save() {
  try { await window.storage.set('pawstock-products', JSON.stringify(products)); } catch(e){}
  try { await window.storage.set('pawstock-queue', JSON.stringify(queue)); } catch(e){}
  try { await window.storage.set('pawstock-orders', JSON.stringify(orderHistory)); } catch(e){}
}

// ============================================================
// NAVIGATION
// ============================================================
function switchView(name) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.getElementById('view-' + name).classList.add('active');
  document.getElementById('tab-' + name).classList.add('active');
  render();
}

// ============================================================
// RENDER
// ============================================================
function render() {
  renderStats();
  renderCatalog();
  renderQueue();
  renderStock();
  renderRecentOrders();
}

function renderStats() {
  const total = products.length;
  const inStock = products.filter(p => p.stock > 0).length;
  const queueCount = queue.filter(q => !q.done).length;
  const outOf = products.filter(p => p.stock === 0).length;

  document.getElementById('stat-products').textContent = total;
  document.getElementById('stat-instock').textContent = inStock;
  document.getElementById('stat-queue').textContent = queueCount;
  document.getElementById('stat-outofstock').textContent = outOf;
  document.getElementById('queue-count').textContent = queueCount;
}

function renderCatalog(filter = '') {
  const body = document.getElementById('catalog-body');
  const f = filter.toLowerCase();
  const list = f ? products.filter(p =>
    p.name.toLowerCase().includes(f) || p.sku.toLowerCase().includes(f)
  ) : products;

  if (list.length === 0) {
    body.innerHTML = `<tr><td colspan="7">
      <div class="empty"><div class="empty-icon">üì¶</div>
      <div class="empty-title">${filter ? 'Brak wynik√≥w' : 'Brak produkt√≥w'}</div>
      <div class="empty-sub">${filter ? 'Zmie≈Ñ wyszukiwanie' : 'Dodaj pierwszy produkt w katalogu'}</div>
      </div></td></tr>`;
    return;
  }

  body.innerHTML = list.map(p => {
    const stockClass = p.stock === 0 ? 'stock-out' : p.stock <= p.minStock ? 'stock-low' : 'stock-ok';
    const stockIcon = p.stock === 0 ? '‚äò' : p.stock <= p.minStock ? '‚ö†' : '‚úì';
    return `<tr>
      <td><span class="sku-badge">${p.sku}</span></td>
      <td><strong>${p.name}</strong></td>
      <td style="color:var(--muted);font-size:0.82rem">${p.desc || '‚Äî'}</td>
      <td>${p.price ? p.price.toFixed(2) + ' z≈Ç' : '‚Äî'}</td>
      <td><span class="stock-badge ${stockClass}">${stockIcon} ${p.stock} szt.</span></td>
      <td style="color:var(--muted);font-size:0.85rem">${p.minStock}</td>
      <td>
        <div style="display:flex;gap:6px">
          <button class="btn btn-secondary btn-sm" onclick="openEditProduct('${p.id}')">‚úè Edytuj</button>
          <button class="btn btn-danger btn-sm" onclick="deleteProduct('${p.id}')">üóë</button>
        </div>
      </td>
    </tr>`;
  }).join('');
}

function renderQueue() {
  const container = document.getElementById('queue-container');
  const active = queue.filter(q => !q.done);
  const done = queue.filter(q => q.done);
  const all = [...active, ...done];

  if (all.length === 0) {
    container.innerHTML = `<div class="empty"><div class="empty-icon">‚úÖ</div>
      <div class="empty-title">Kolejka pusta</div>
      <div class="empty-sub">Wszystkie zam√≥wienia sƒÖ zrealizowane</div></div>`;
    return;
  }

  const today = new Date(); today.setHours(0,0,0,0);

  let html = '';
  if (active.length > 0) {
    html += `<div class="section-title" style="margin-bottom:16px">Do wyprodukowania (${active.length})</div>`;
    html += `<div class="queue-list" style="margin-bottom:28px">`;
    active.forEach((item, idx) => {
      const prioClass = item.priority === 1 ? 'high' : item.priority === 3 ? 'low' : '';
      const deadlineStr = item.deadline ? formatDate(item.deadline) : null;
      const isUrgent = item.deadline && new Date(item.deadline) < new Date(today.getTime() + 2 * 86400000);

      html += `<div class="queue-item" id="qi-${item.id}">
        <div class="queue-pos ${prioClass}">${idx+1}</div>
        <div class="queue-info">
          <div class="queue-name">${item.productName}</div>
          <div class="queue-meta">
            <span class="queue-chip">${item.sku}</span>
            <span class="queue-chip qty">üì¶ ${item.qty} szt.</span>
            ${deadlineStr ? `<span class="queue-chip deadline${isUrgent ? ' urgent' : ''}">‚è∞ ${deadlineStr}</span>` : ''}
            <span class="queue-chip">${['', 'üî¥ Wysoki', 'üü° Normalny', 'üü¢ Niski'][item.priority]}</span>
            <span class="queue-chip" style="color:var(--muted)">${formatDateTime(item.addedAt)}</span>
          </div>
        </div>
        <div class="queue-actions">
          <button class="btn btn-primary btn-sm" onclick="markDone('${item.id}')">‚úì Wyprodukowano</button>
          <button class="btn btn-danger btn-sm btn-icon" onclick="removeQueueItem('${item.id}')" title="Usu≈Ñ">üóë</button>
        </div>
      </div>`;
    });
    html += `</div>`;
  }

  if (done.length > 0) {
    html += `<div class="section-title" style="margin-bottom:16px">Uko≈Ñczone (${done.length})</div>`;
    html += `<div class="queue-list">`;
    done.forEach(item => {
      html += `<div class="queue-item done" id="qi-${item.id}">
        <div class="queue-pos" style="background:var(--muted)">‚úì</div>
        <div class="queue-info">
          <div class="queue-name" style="text-decoration:line-through">${item.productName}</div>
          <div class="queue-meta">
            <span class="queue-chip">${item.sku}</span>
            <span class="queue-chip qty">üì¶ ${item.qty} szt.</span>
          </div>
        </div>
        <div class="queue-actions">
          <button class="btn btn-danger btn-sm btn-icon" onclick="removeQueueItem('${item.id}')" title="Usu≈Ñ">üóë</button>
        </div>
      </div>`;
    });
    html += `</div>`;
  }

  container.innerHTML = html;
}

function renderStock() {
  // Alerts
  const alerts = products.filter(p => p.stock <= p.minStock);
  const alertsDiv = document.getElementById('stock-alerts');
  if (alerts.length === 0) {
    alertsDiv.innerHTML = `<div style="color:var(--accent);font-size:0.88rem;padding:12px 0">‚úÖ Wszystkie stany magazynowe sƒÖ w normie.</div>`;
  } else {
    alertsDiv.innerHTML = `<div class="queue-list">${alerts.map(p => {
      const cls = p.stock === 0 ? 'danger' : 'warn';
      return `<div class="queue-item" style="border-left: 3px solid var(--${p.stock===0?'red':'amber'}); padding-left: 17px">
        <div class="queue-pos" style="background:var(--${p.stock===0?'red':'amber'})">${p.stock===0?'‚äò':'!'}</div>
        <div class="queue-info">
          <div class="queue-name">${p.name}</div>
          <div class="queue-meta">
            <span class="queue-chip">${p.sku}</span>
            <span class="queue-chip" style="color:var(--${p.stock===0?'red':'amber'})">
              ${p.stock===0 ? 'BRAK TOWARU' : `‚ö† Niski stan: ${p.stock} szt.`}
            </span>
            <span class="queue-chip">Min: ${p.minStock} szt.</span>
          </div>
        </div>
        <button class="btn btn-primary btn-sm" onclick="openEditProduct('${p.id}');switchView('catalog')">Zaktualizuj</button>
      </div>`;
    }).join('')}</div>`;
  }

  // Full table
  const body = document.getElementById('stock-body');
  if (products.length === 0) {
    body.innerHTML = `<tr><td colspan="6"><div class="empty"><div class="empty-icon">üì¶</div><div class="empty-title">Brak produkt√≥w</div></div></td></tr>`;
    return;
  }

  body.innerHTML = products.map(p => {
    const stockClass = p.stock === 0 ? 'stock-out' : p.stock <= p.minStock ? 'stock-low' : 'stock-ok';
    const stockIcon = p.stock === 0 ? '‚äò' : p.stock <= p.minStock ? '‚ö†' : '‚úì';
    return `<tr>
      <td><span class="sku-badge">${p.sku}</span></td>
      <td><strong>${p.name}</strong></td>
      <td><span class="stock-badge ${stockClass}">${stockIcon} ${p.stock} szt.</span></td>
      <td style="color:var(--muted)">${p.minStock}</td>
      <td><span class="stock-badge ${stockClass}">${p.stock===0?'Brak':p.stock<=p.minStock?'Niski':'OK'}</span></td>
      <td>
        <div style="display:flex;align-items:center;gap:8px">
          <div class="qty-control">
            <button onclick="changeQty('stock-qty-${p.id}', -1)">‚àí</button>
            <input type="number" id="stock-qty-${p.id}" value="${p.stock}" min="0">
            <button onclick="changeQty('stock-qty-${p.id}', 1)">+</button>
          </div>
          <button class="btn btn-secondary btn-sm" onclick="updateStock('${p.id}')">üíæ Zapisz</button>
        </div>
      </td>
    </tr>`;
  }).join('');
}

function renderRecentOrders() {
  const div = document.getElementById('recent-orders');
  if (orderHistory.length === 0) {
    div.innerHTML = `<div class="empty"><div class="empty-icon">üìã</div><div class="empty-title">Brak historii</div><div class="empty-sub">Tutaj pojawiƒÖ siƒô ostatnie zam√≥wienia</div></div>`;
    return;
  }

  const recent = [...orderHistory].reverse().slice(0, 8);
  div.innerHTML = `<div style="display:flex;flex-direction:column;gap:8px">
    ${recent.map(o => `
      <div style="padding:10px 14px;background:var(--card);border:1px solid var(--border);border-radius:8px">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:8px">
          <div>
            <div style="font-weight:600;font-size:0.85rem;margin-bottom:3px">${o.productName}</div>
            <div style="display:flex;gap:6px;flex-wrap:wrap">
              <span class="sku-badge" style="font-size:0.7rem">${o.sku}</span>
              <span class="queue-chip qty" style="font-size:0.7rem">üì¶ ${o.qty}</span>
              <span class="queue-chip" style="font-size:0.7rem">${o.action === 'stock' ? '‚úì Z magazynu' : '‚öô Do produkcji'}</span>
            </div>
          </div>
          <span style="font-size:0.7rem;color:var(--muted);white-space:nowrap;font-family:'JetBrains Mono',monospace">${formatDateTime(o.time)}</span>
        </div>
      </div>`).join('')}
  </div>`;
}

// ============================================================
// ORDER PROCESSING
// ============================================================
function processOrder() {
  const skuRaw = document.getElementById('order-sku').value.trim().toUpperCase();
  const qty = parseInt(document.getElementById('order-qty').value) || 1;
  const deadline = document.getElementById('order-deadline').value;
  const resultDiv = document.getElementById('order-result');

  if (!skuRaw) {
    document.getElementById('order-sku').classList.add('error');
    setTimeout(() => document.getElementById('order-sku').classList.remove('error'), 2000);
    return;
  }

  const product = products.find(p => p.sku === skuRaw);

  if (!product) {
    resultDiv.innerHTML = `<div class="order-result">
      <div class="order-result-title">‚äò Nieznane SKU</div>
      <p>Produkt o SKU <strong>${skuRaw}</strong> nie istnieje w katalogu. Sprawd≈∫ SKU lub dodaj produkt.</p>
    </div>`;
    return;
  }

  if (product.stock >= qty) {
    // Dostƒôpne na stanie ‚Äî wydaj z magazynu
    product.stock -= qty;

    const entry = { id: uid(), sku: product.sku, productName: product.name, qty, time: new Date().toISOString(), action: 'stock', deadline };
    orderHistory.push(entry);
    save();

    resultDiv.innerHTML = `<div class="order-result success">
      <div class="order-result-title">‚úÖ Dostƒôpne na stanie!</div>
      <p>Produkt <strong>${product.name}</strong> (${qty} szt.) jest dostƒôpny w magazynie.<br>
      Stan zaktualizowany: <strong>${product.stock} szt.</strong> pozosta≈Ço.</p>
    </div>`;

    notify(`‚úì ${product.name} ‚Äî wydano ${qty} szt. z magazynu`);
    clearOrderForm();
  } else {
    // Brak na stanie ‚Äî dodaj do kolejki
    const neededQty = qty - product.stock;
    if (product.stock > 0) {
      product.stock = 0;
    }

    const queueItem = {
      id: uid(),
      sku: product.sku,
      productName: product.name,
      qty: neededQty,
      priority: selectedPrio,
      deadline: deadline || null,
      addedAt: new Date().toISOString(),
      done: false
    };
    queue.push(queueItem);

    const entry = { id: uid(), sku: product.sku, productName: product.name, qty, time: new Date().toISOString(), action: 'queue', deadline };
    orderHistory.push(entry);
    save();

    const extra = product.stock > 0 ? ` (${product.stock} szt. wydano z resztek magazynowych, ` : '';
    resultDiv.innerHTML = `<div class="order-result added">
      <div class="order-result-title">‚öô Dodano do kolejki produkcyjnej</div>
      <p>Brak wystarczajƒÖcego stanu dla <strong>${product.name}</strong>.<br>
      <strong>${neededQty} szt.</strong> dodano do kolejki produkcyjnej z priorytetem: ${['','üî¥ Wysoki','üü° Normalny','üü¢ Niski'][selectedPrio]}.</p>
    </div>`;

    notify(`‚öô ${product.name} ‚Äî ${neededQty} szt. w kolejce produkcyjnej`, 'warn');
    clearOrderForm();
  }

  render();
}

function clearOrderForm() {
  setTimeout(() => {
    document.getElementById('order-sku').value = '';
    document.getElementById('order-qty').value = 1;
    document.getElementById('order-deadline').value = '';
    selectPrio(2);
  }, 3000);
}

// ============================================================
// QUEUE ACTIONS
// ============================================================
function markDone(id) {
  const item = queue.find(q => q.id === id);
  if (!item) return;
  item.done = true;

  // Also increase stock
  const product = products.find(p => p.sku === item.sku);
  if (product) {
    // Don't add to stock ‚Äî item was produced for order, just mark done
  }

  save();
  renderQueue();
  renderStats();
  notify(`‚úì ${item.productName} oznaczono jako wyprodukowane!`);
}

function removeQueueItem(id) {
  queue = queue.filter(q => q.id !== id);
  save();
  renderQueue();
  renderStats();
}

function clearDoneQueue() {
  queue = queue.filter(q => !q.done);
  save();
  renderQueue();
  renderStats();
  notify('üóë Usuniƒôto uko≈Ñczone pozycje');
}

// ============================================================
// STOCK UPDATE
// ============================================================
function updateStock(productId) {
  const input = document.getElementById('stock-qty-' + productId);
  const val = parseInt(input.value);
  if (isNaN(val) || val < 0) return;
  const p = products.find(p => p.id === productId);
  if (!p) return;
  p.stock = val;
  save();
  renderStock();
  renderStats();
  notify(`üíæ Stan ${p.name} zaktualizowany: ${val} szt.`);
}

// ============================================================
// PRODUCT CRUD
// ============================================================
function openAddProduct() {
  editingProductId = null;
  document.getElementById('modal-product-title').textContent = 'Dodaj produkt';
  document.getElementById('p-sku').value = '';
  document.getElementById('p-name').value = '';
  document.getElementById('p-desc').value = '';
  document.getElementById('p-price').value = '';
  document.getElementById('p-stock').value = '0';
  document.getElementById('p-min').value = '2';
  document.getElementById('p-sku').disabled = false;
  document.getElementById('modal-product').style.display = 'flex';
}

function openEditProduct(id) {
  const p = products.find(p => p.id === id);
  if (!p) return;
  editingProductId = id;
  document.getElementById('modal-product-title').textContent = 'Edytuj produkt';
  document.getElementById('p-sku').value = p.sku;
  document.getElementById('p-name').value = p.name;
  document.getElementById('p-desc').value = p.desc || '';
  document.getElementById('p-price').value = p.price || '';
  document.getElementById('p-stock').value = p.stock;
  document.getElementById('p-min').value = p.minStock;
  document.getElementById('p-sku').disabled = true;
  document.getElementById('modal-product').style.display = 'flex';
}

function saveProduct() {
  const sku = document.getElementById('p-sku').value.trim().toUpperCase();
  const name = document.getElementById('p-name').value.trim();
  const desc = document.getElementById('p-desc').value.trim();
  const price = parseFloat(document.getElementById('p-price').value) || 0;
  const stock = parseInt(document.getElementById('p-stock').value) || 0;
  const minStock = parseInt(document.getElementById('p-min').value) || 0;

  if (!sku) { document.getElementById('p-sku').classList.add('error'); return; }
  if (!name) { document.getElementById('p-name').classList.add('error'); return; }

  if (editingProductId) {
    const p = products.find(p => p.id === editingProductId);
    if (p) { p.name = name; p.desc = desc; p.price = price; p.stock = stock; p.minStock = minStock; }
  } else {
    if (products.find(p => p.sku === sku)) {
      document.getElementById('p-sku').classList.add('error');
      notify('SKU ju≈º istnieje w katalogu!', 'error');
      return;
    }
    products.push({ id: uid(), sku, name, desc, price, stock, minStock });
  }

  save();
  render();
  closeModal('modal-product');
  notify(editingProductId ? `‚úì Produkt zaktualizowany` : `‚úì Produkt ${sku} dodany!`);
}

function deleteProduct(id) {
  const p = products.find(p => p.id === id);
  if (!p) return;
  if (!confirm(`UsunƒÖƒá produkt "${p.name}" (${p.sku})?`)) return;
  products = products.filter(p => p.id !== id);
  save();
  render();
  notify(`üóë Usuniƒôto: ${p.name}`);
}

// ============================================================
// SKU AUTOCOMPLETE
// ============================================================
function skuAutocomplete(val) {
  const dd = document.getElementById('sku-dropdown');
  const v = val.trim().toUpperCase();
  if (!v) { dd.style.display = 'none'; return; }

  const matches = products.filter(p =>
    p.sku.includes(v) || p.name.toUpperCase().includes(v)
  ).slice(0, 8);

  if (!matches.length) { dd.style.display = 'none'; return; }

  dd.innerHTML = matches.map((p, i) => {
    const stockClass = p.stock === 0 ? 'color:var(--red)' : p.stock <= p.minStock ? 'color:var(--amber)' : 'color:var(--accent)';
    return `<div class="sku-option" onclick="selectSkuOption('${p.sku}')">
      <div>
        <div class="so-name">${p.name}</div>
        <div class="so-sku">${p.sku}</div>
      </div>
      <div class="so-stock" style="${stockClass}">${p.stock} szt.</div>
    </div>`;
  }).join('');
  dd.style.display = 'block';
}

function selectSkuOption(sku) {
  document.getElementById('order-sku').value = sku;
  document.getElementById('sku-dropdown').style.display = 'none';
}

function closeSkuDropdown() {
  document.getElementById('sku-dropdown').style.display = 'none';
}

function skuKeydown(e) {
  if (e.key === 'Enter') {
    closeSkuDropdown();
    processOrder();
  }
}

// ============================================================
// PRIORITY
// ============================================================
function selectPrio(p) {
  selectedPrio = p;
  document.querySelectorAll('.prio-opt').forEach(el => {
    el.classList.toggle('selected', parseInt(el.dataset.p) === p);
  });
}

// ============================================================
// CATALOG FILTER
// ============================================================
function filterCatalog(val) {
  renderCatalog(val);
}

// ============================================================
// HELPERS
// ============================================================
function changeQty(inputId, delta) {
  const inp = document.getElementById(inputId);
  inp.value = Math.max(0, (parseInt(inp.value) || 0) + delta);
}

function closeModal(id) {
  document.getElementById(id).style.display = 'none';
}

function uid() {
  return Math.random().toString(36).substr(2, 9);
}

function formatDate(str) {
  if (!str) return '';
  const d = new Date(str);
  return d.toLocaleDateString('pl-PL', { day: '2-digit', month: '2-digit', year: 'numeric' });
}

function formatDateTime(str) {
  if (!str) return '';
  const d = new Date(str);
  return d.toLocaleDateString('pl-PL', { day: '2-digit', month: '2-digit' }) + ' ' +
    d.toLocaleTimeString('pl-PL', { hour: '2-digit', minute: '2-digit' });
}

let notifTimeout;
function notify(msg, type = '') {
  const existing = document.getElementById('notif');
  if (existing) existing.remove();
  clearTimeout(notifTimeout);

  const el = document.createElement('div');
  el.id = 'notif';
  el.className = 'notification' + (type ? ' ' + type : '');
  el.textContent = msg;
  document.body.appendChild(el);
  notifTimeout = setTimeout(() => el.remove(), 3500);
}

// Uppercase SKU input
document.getElementById('order-sku').addEventListener('input', function() {
  const pos = this.selectionStart;
  this.value = this.value.toUpperCase();
  this.setSelectionRange(pos, pos);
});

// ============================================================
// INIT
// ============================================================
loadData();
</script>
</body>
</html>
